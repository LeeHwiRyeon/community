<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤êµ­ì–´ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-number.good {
            color: #27ae60;
        }

        .stat-number.warning {
            color: #f39c12;
        }

        .stat-number.error {
            color: #e74c3c;
        }

        .stat-description {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .language-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .language-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-flag {
            font-size: 1.5em;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
        }

        .language-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .missing-keys {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .missing-keys h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .missing-key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .missing-key-item:hover {
            background: #f8f9fa;
        }

        .key-info {
            flex: 1;
        }

        .key-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .key-namespace {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .key-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ ë‹¤êµ­ì–´ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì „ ì„¸ê³„ ì‚¬ìš©ìë¥¼ ìœ„í•œ ë‹¤êµ­ì–´ ì§€ì› í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="refreshData()">ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn btn-success" onclick="checkMissingKeys()">ëˆ„ë½ í‚¤ í™•ì¸</button>
            <button class="btn btn-warning" onclick="generateReport()">ë¦¬í¬íŠ¸ ìƒì„±</button>
        </div>

        <div id="message"></div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>ì§€ì› ì–¸ì–´</h3>
                <div id="supportedLanguages" class="stat-number">-</div>
                <div class="stat-description">ì´ ì§€ì› ì–¸ì–´ ìˆ˜</div>
            </div>
            <div class="stat-card">
                <h3>ë²ˆì—­ ì™„ì„±ë„</h3>
                <div id="overallCompletion" class="stat-number">-</div>
                <div class="stat-description">ì „ì²´ í‰ê·  ì™„ì„±ë„</div>
            </div>
            <div class="stat-card">
                <h3>ì´ ë²ˆì—­ í‚¤</h3>
                <div id="totalKeys" class="stat-number">-</div>
                <div class="stat-description">ëª¨ë“  ì–¸ì–´ì˜ ì´ í‚¤ ìˆ˜</div>
            </div>
            <div class="stat-card">
                <h3>ëˆ„ë½ëœ í‚¤</h3>
                <div id="missingKeys" class="stat-number">-</div>
                <div class="stat-description">ë²ˆì—­ì´ í•„ìš”í•œ í‚¤</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>ì–¸ì–´ë³„ ë²ˆì—­ ì™„ì„±ë„</h3>
            <canvas id="completionChart" width="400" height="200"></canvas>
        </div>

        <div class="chart-container">
            <h3>ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ ë²ˆì—­ í˜„í™©</h3>
            <canvas id="namespaceChart" width="400" height="200"></canvas>
        </div>

        <div class="language-grid" id="languageGrid">
            <div class="loading">ì–¸ì–´ë³„ ë²ˆì—­ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <div class="missing-keys" id="missingKeysSection" style="display: none;">
            <h3>ëˆ„ë½ëœ ë²ˆì—­ í‚¤</h3>
            <div id="missingKeysList">
                <div class="loading">ëˆ„ë½ëœ í‚¤ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        let completionChart = null;
        let namespaceChart = null;
        let translationStats = {};

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        document.addEventListener('DOMContentLoaded', function () {
            refreshData();
            initializeCharts();
        });

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            try {
                showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'info');

                // ë²ˆì—­ í†µê³„ ì¡°íšŒ
                const response = await fetch('http://localhost:5000/api/i18n/stats');
                const data = await response.json();

                if (data.success) {
                    translationStats = data.data;
                    updateDashboard();
                    showMessage('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
                showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            const languages = Object.keys(translationStats);
            const supportedLanguages = languages.length;

            // ì „ì²´ ë²ˆì—­ ì™„ì„±ë„ ê³„ì‚°
            let totalKeys = 0;
            let totalCompletedKeys = 0;

            languages.forEach(lang => {
                const namespaces = Object.keys(translationStats[lang]);
                namespaces.forEach(ns => {
                    totalKeys += translationStats[lang][ns].keyCount || 0;
                    totalCompletedKeys += translationStats[lang][ns].keyCount || 0;
                });
            });

            const overallCompletion = totalKeys > 0 ? (totalCompletedKeys / totalKeys) * 100 : 0;

            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('supportedLanguages').textContent = supportedLanguages;
            document.getElementById('overallCompletion').textContent = overallCompletion.toFixed(1) + '%';
            document.getElementById('totalKeys').textContent = totalKeys;
            document.getElementById('missingKeys').textContent = '0'; // ì‹¤ì œë¡œëŠ” ê³„ì‚° í•„ìš”

            // ì–¸ì–´ë³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
            updateLanguageCards();

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateCharts();
        }

        // ì–¸ì–´ë³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateLanguageCards() {
            const container = document.getElementById('languageGrid');
            const languages = [
                { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
                { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
                { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
                { code: 'zh-CN', name: 'ä¸­æ–‡ (ç®€ä½“)', flag: 'ğŸ‡¨ğŸ‡³' },
                { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' }
            ];

            const html = languages.map(lang => {
                const stats = translationStats[lang.code] || {};
                const totalKeys = Object.values(stats).reduce((sum, ns) => sum + (ns.keyCount || 0), 0);
                const completionRate = totalKeys > 0 ? (totalKeys / 100) * 100 : 0; // ì„ì‹œ ê³„ì‚°

                return `
                    <div class="language-card">
                        <h4>
                            <span class="language-flag">${lang.flag}</span>
                            ${lang.name}
                        </h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${completionRate}%"></div>
                        </div>
                        <div class="language-stats">
                            <span>ì™„ì„±ë„: ${completionRate.toFixed(1)}%</span>
                            <span>í‚¤ ìˆ˜: ${totalKeys}</span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initializeCharts() {
            // ì™„ì„±ë„ ì°¨íŠ¸
            const completionCtx = document.getElementById('completionChart').getContext('2d');
            completionChart = new Chart(completionCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ë²ˆì—­ ì™„ì„±ë„ (%)',
                        data: [],
                        backgroundColor: 'rgba(52, 152, 219, 0.8)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì°¨íŠ¸
            const namespaceCtx = document.getElementById('namespaceChart').getContext('2d');
            namespaceChart = new Chart(namespaceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['common', 'navigation', 'forms', 'errors', 'messages'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#3498db',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            const languages = [
                { code: 'ko', name: 'í•œêµ­ì–´' },
                { code: 'en', name: 'English' },
                { code: 'ja', name: 'æ—¥æœ¬èª' },
                { code: 'zh-CN', name: 'ä¸­æ–‡' },
                { code: 'es', name: 'EspaÃ±ol' }
            ];

            const labels = languages.map(lang => lang.name);
            const data = languages.map(lang => {
                const stats = translationStats[lang.code] || {};
                const totalKeys = Object.values(stats).reduce((sum, ns) => sum + (ns.keyCount || 0), 0);
                return totalKeys > 0 ? (totalKeys / 100) * 100 : 0; // ì„ì‹œ ê³„ì‚°
            });

            completionChart.data.labels = labels;
            completionChart.data.datasets[0].data = data;
            completionChart.update();

            // ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            const namespaceData = [25, 20, 15, 10, 30]; // ì„ì‹œ ë°ì´í„°
            namespaceChart.data.datasets[0].data = namespaceData;
            namespaceChart.update();
        }

        // ëˆ„ë½ëœ í‚¤ í™•ì¸
        async function checkMissingKeys() {
            try {
                showMessage('ëˆ„ë½ëœ í‚¤ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...', 'info');

                const response = await fetch('http://localhost:5000/api/i18n/missing-keys?language=en');
                const data = await response.json();

                if (data.success) {
                    displayMissingKeys(data.data.missingKeys);
                    showMessage('ëˆ„ë½ëœ í‚¤ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    showMessage('ëˆ„ë½ëœ í‚¤ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('ëˆ„ë½ëœ í‚¤ í™•ì¸ ì˜¤ë¥˜:', error);
                showMessage('ëˆ„ë½ëœ í‚¤ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ëˆ„ë½ëœ í‚¤ í‘œì‹œ
        function displayMissingKeys(missingKeys) {
            const section = document.getElementById('missingKeysSection');
            const list = document.getElementById('missingKeysList');

            if (Object.keys(missingKeys).length === 0) {
                list.innerHTML = '<div class="loading">ëˆ„ë½ëœ í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                const html = Object.entries(missingKeys).map(([namespace, keys]) => `
                    <div>
                        <h4>${namespace}</h4>
                        ${keys.map(key => `
                            <div class="missing-key-item">
                                <div class="key-info">
                                    <div class="key-name">${key.key}</div>
                                    <div class="key-namespace">${namespace}</div>
                                </div>
                                <div class="key-actions">
                                    <button class="btn btn-primary btn-small" onclick="translateKey('${namespace}', '${key.key}')">
                                        ë²ˆì—­
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `).join('');

                list.innerHTML = html;
            }

            section.style.display = 'block';
        }

        // í‚¤ ë²ˆì—­
        function translateKey(namespace, key) {
            alert(`í‚¤ "${key}" (${namespace}) ë²ˆì—­ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.`);
        }

        // ë¦¬í¬íŠ¸ ìƒì„±
        function generateReport() {
            alert('ë²ˆì—­ ë¦¬í¬íŠ¸ ìƒì„± ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.');
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${message}</div>`;

            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ (5ë¶„ë§ˆë‹¤)
        setInterval(refreshData, 5 * 60 * 1000);
    </script>
</body>

</html>