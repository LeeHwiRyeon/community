import React, { useState, useEffect } from 'react'
import { Box, Grid, Card, CardBody, Heading, Text, VStack, HStack, Select, Stat, StatLabel, StatNumber, StatHelpText, StatArrow, Badge, Button } from '@chakra-ui/react'
import {
    Chart as ChartJS,
    CategoryScale,
    LinearScale,
    PointElement,
    LineElement,
    BarElement,
    Title,
    Tooltip,
    Legend,
    ArcElement,
} from 'chart.js'
import { Line, Bar, Doughnut } from 'react-chartjs-2'

ChartJS.register(
    CategoryScale,
    LinearScale,
    PointElement,
    LineElement,
    BarElement,
    Title,
    Tooltip,
    Legend,
    ArcElement
)

// Mock analytics data
const mockAnalytics = {
    totalRevenue: 12500000,
    totalOrders: 234,
    totalVisitors: 15420,
    conversionRate: 2.8,
    revenueChange: 12.5,
    ordersChange: 8.3,
    visitorsChange: -2.1,
    conversionChange: 5.2,

    salesData: {
        labels: ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî'],
        datasets: [{
            label: 'Îß§Ï∂ú (‚Ç©)',
            data: [1800000, 2200000, 1900000, 2500000, 2800000, 3200000],
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.1
        }]
    },

    visitorsData: {
        labels: ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'],
        datasets: [{
            label: 'Î∞©Î¨∏Ïûê Ïàò',
            data: [2100, 2400, 2200, 2600, 2800, 3200, 2900],
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
        }]
    },

    categoryData: {
        labels: ['ÏùòÏÉÅ', 'Ïï°ÏÑ∏ÏÑúÎ¶¨', 'ÏÜåÌíà', 'Í∏∞ÌÉÄ'],
        datasets: [{
            data: [45, 25, 20, 10],
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 205, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
            ],
        }]
    },

    topProducts: [
        { name: 'ÏΩîÏä§ÌîÑÎ†à ÏùòÏÉÅ A', sales: 45, revenue: 4500000 },
        { name: 'ÏΩîÏä§ÌîÑÎ†à Ïï°ÏÑ∏ÏÑúÎ¶¨ B', sales: 32, revenue: 1600000 },
        { name: 'ÏΩîÏä§ÌîÑÎ†à ÏÜåÌíà C', sales: 28, revenue: 420000 },
        { name: 'ÏΩîÏä§ÌîÑÎ†à ÏùòÏÉÅ D', sales: 24, revenue: 3600000 },
        { name: 'ÏΩîÏä§ÌîÑÎ†à Ïï°ÏÑ∏ÏÑúÎ¶¨ E', sales: 18, revenue: 270000 },
    ]
}

const AnalyticsDashboard: React.FC = () => {
    const [timeRange, setTimeRange] = useState('7d')
    const [analytics, setAnalytics] = useState(mockAnalytics)

    useEffect(() => {
        // TODO: Ïã§Ï†ú APIÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        // fetchAnalytics(timeRange)
    }, [timeRange])

    const chartOptions = {
        responsive: true,
        plugins: {
            legend: {
                position: 'top' as const,
            },
            title: {
                display: false,
            },
        },
    }

    const doughnutOptions = {
        responsive: true,
        plugins: {
            legend: {
                position: 'right' as const,
            },
        },
    }

    return (
        <Box>
            <VStack spacing={6} align="stretch">
                <HStack justify="space-between" align="center">
                    <Heading size="lg">ÏÉÅÏ†ê Î∂ÑÏÑù Î∞è ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú</Heading>
                    <HStack>
                        <Select value={timeRange} onChange={(e) => setTimeRange(e.target.value)} w="150px">
                            <option value="7d">ÏßÄÎÇú 7Ïùº</option>
                            <option value="30d">ÏßÄÎÇú 30Ïùº</option>
                            <option value="90d">ÏßÄÎÇú 90Ïùº</option>
                            <option value="1y">ÏßÄÎÇú 1ÎÖÑ</option>
                        </Select>
                        <Button colorScheme="blue">Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</Button>
                    </HStack>
                </HStack>

                {/* Key Metrics */}
                <Grid templateColumns="repeat(auto-fit, minmax(250px, 1fr))" gap={6}>
                    <Card>
                        <CardBody>
                            <Stat>
                                <StatLabel>Ï¥ù Îß§Ï∂ú</StatLabel>
                                <StatNumber>‚Ç©{analytics.totalRevenue.toLocaleString()}</StatNumber>
                                <StatHelpText>
                                    <StatArrow type={analytics.revenueChange > 0 ? 'increase' : 'decrease'} />
                                    {Math.abs(analytics.revenueChange)}%
                                </StatHelpText>
                            </Stat>
                        </CardBody>
                    </Card>

                    <Card>
                        <CardBody>
                            <Stat>
                                <StatLabel>Ï¥ù Ï£ºÎ¨∏ Ïàò</StatLabel>
                                <StatNumber>{analytics.totalOrders.toLocaleString()}</StatNumber>
                                <StatHelpText>
                                    <StatArrow type={analytics.ordersChange > 0 ? 'increase' : 'decrease'} />
                                    {Math.abs(analytics.ordersChange)}%
                                </StatHelpText>
                            </Stat>
                        </CardBody>
                    </Card>

                    <Card>
                        <CardBody>
                            <Stat>
                                <StatLabel>Ï¥ù Î∞©Î¨∏Ïûê Ïàò</StatLabel>
                                <StatNumber>{analytics.totalVisitors.toLocaleString()}</StatNumber>
                                <StatHelpText>
                                    <StatArrow type={analytics.visitorsChange > 0 ? 'increase' : 'decrease'} />
                                    {Math.abs(analytics.visitorsChange)}%
                                </StatHelpText>
                            </Stat>
                        </CardBody>
                    </Card>

                    <Card>
                        <CardBody>
                            <Stat>
                                <StatLabel>Ï†ÑÌôòÏú®</StatLabel>
                                <StatNumber>{analytics.conversionRate}%</StatNumber>
                                <StatHelpText>
                                    <StatArrow type={analytics.conversionChange > 0 ? 'increase' : 'decrease'} />
                                    {Math.abs(analytics.conversionChange)}%
                                </StatHelpText>
                            </Stat>
                        </CardBody>
                    </Card>
                </Grid>

                {/* Charts */}
                <Grid templateColumns="repeat(auto-fit, minmax(400px, 1fr))" gap={6}>
                    <Card>
                        <CardBody>
                            <Heading size="md" mb={4}>Îß§Ï∂ú Ï∂îÏù¥</Heading>
                            <Line options={chartOptions} data={analytics.salesData} />
                        </CardBody>
                    </Card>

                    <Card>
                        <CardBody>
                            <Heading size="md" mb={4}>ÏùºÏùº Î∞©Î¨∏Ïûê Ïàò</Heading>
                            <Bar options={chartOptions} data={analytics.visitorsData} />
                        </CardBody>
                    </Card>
                </Grid>

                <Grid templateColumns="repeat(auto-fit, minmax(300px, 1fr))" gap={6}>
                    <Card>
                        <CardBody>
                            <Heading size="md" mb={4}>Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌåêÎß§ ÎπÑÏú®</Heading>
                            <Doughnut options={doughnutOptions} data={analytics.categoryData} />
                        </CardBody>
                    </Card>

                    <Card>
                        <CardBody>
                            <Heading size="md" mb={4}>Ïù∏Í∏∞ ÏÉÅÌíà TOP 5</Heading>
                            <VStack align="stretch" spacing={3}>
                                {analytics.topProducts.map((product, index) => (
                                    <HStack key={product.name} justify="space-between" p={2} bg="gray.50" borderRadius="md">
                                        <HStack>
                                            <Badge colorScheme="blue" mr={2}>{index + 1}</Badge>
                                            <VStack align="start" spacing={0}>
                                                <Text fontWeight="bold" fontSize="sm">{product.name}</Text>
                                                <Text fontSize="xs" color="gray.600">
                                                    ÌåêÎß§Îüâ: {product.sales}Í∞ú | Îß§Ï∂ú: ‚Ç©{product.revenue.toLocaleString()}
                                                </Text>
                                            </VStack>
                                        </HStack>
                                    </HStack>
                                ))}
                            </VStack>
                        </CardBody>
                    </Card>
                </Grid>

                {/* AI Insights */}
                <Card>
                    <CardBody>
                        <Heading size="md" mb={4}>AI Ï∂îÏ≤ú Ïù∏ÏÇ¨Ïù¥Ìä∏</Heading>
                        <VStack align="stretch" spacing={3}>
                            <Box p={3} bg="blue.50" borderRadius="md">
                                <Text fontWeight="bold" color="blue.700">üìà Îß§Ï∂ú Ï¶ùÍ∞Ä Í∏∞Ìöå</Text>
                                <Text fontSize="sm" color="blue.600">
                                    Ïï°ÏÑ∏ÏÑúÎ¶¨ Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò ÌåêÎß§ÎüâÏù¥ 15% Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§. Ïû¨Í≥†Î•º ÎäòÎ¶¨Îäî Í≤ÉÏùÑ Í≥†Î†§Ìï¥Î≥¥ÏÑ∏Ïöî.
                                </Text>
                            </Box>

                            <Box p={3} bg="green.50" borderRadius="md">
                                <Text fontWeight="bold" color="green.700">üéØ ÌÉÄÍ≤ü Í≥†Í∞ù Î∂ÑÏÑù</Text>
                                <Text fontSize="sm" color="green.600">
                                    20-30ÎåÄ Ïó¨ÏÑ± Í≥†Í∞ùÏùò Ï†ÑÌôòÏú®Ïù¥ Í∞ÄÏû• ÎÜíÏäµÎãàÎã§. Ïù¥ Í∑∏Î£πÏùÑ ÎåÄÏÉÅÏúºÎ°ú Ìïú ÎßàÏºÄÌåÖÏùÑ Í∞ïÌôîÌï¥Î≥¥ÏÑ∏Ïöî.
                                </Text>
                            </Box>

                            <Box p={3} bg="orange.50" borderRadius="md">
                                <Text fontWeight="bold" color="orange.700">‚ö° Ï¶âÏãú Ïï°ÏÖò Ï†úÏïà</Text>
                                <Text fontSize="sm" color="orange.600">
                                    Ï£ºÎßê Î∞©Î¨∏ÏûêÍ∞Ä ÌèâÏùºÎ≥¥Îã§ 40% ÎÜíÏäµÎãàÎã§. Ï£ºÎßê ÌïúÏ†ï ÌîÑÎ°úÎ™®ÏÖòÏùÑ Í≥†Î†§Ìï¥Î≥¥ÏÑ∏Ïöî.
                                </Text>
                            </Box>
                        </VStack>
                    </CardBody>
                </Card>

                {/* Google Analytics Integration Status */}
                <Card>
                    <CardBody>
                        <HStack justify="space-between" align="center">
                            <VStack align="start" spacing={1}>
                                <Heading size="md">Google Analytics Ïó∞Îèô</Heading>
                                <Text fontSize="sm" color="gray.600">
                                    Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏ÌïòÍ≥† Îçî ÏûêÏÑ∏Ìïú Î∂ÑÏÑùÏùÑ ÏúÑÌï¥ Google AnalyticsÏôÄ Ïó∞ÎèôÌï¥Î≥¥ÏÑ∏Ïöî.
                                </Text>
                            </VStack>
                            <Button colorScheme="red">
                                Analytics Ïó∞ÎèôÌïòÍ∏∞
                            </Button>
                        </HStack>
                    </CardBody>
                </Card>
            </VStack>
        </Box>
    )
}

export default AnalyticsDashboard